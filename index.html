<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Economic Inequality and Living Standards Across Malaysian States (2022)</title>
<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap');
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 20px; background-color: #eafbff; font-size: 17px; line-height: 1.7; color: #000; }
.container { display: grid; grid-template-columns: repeat(auto-fit, minmax(540px, 1fr)); gap: 32px; max-width: 1200px; margin: 0 auto; justify-items: center; }
.container-wide { display: grid; grid-template-columns: repeat(auto-fit, minmax(520px, 1fr)); gap: 72px; max-width: 1200px; margin: 0 auto; align-items: start; justify-items: center; }
.vis-section { max-width: 520px; margin: 0 auto; width: 100%; text-align: center; background: #ffffffbe; padding: 24px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid rgba(0,0,0,0.05); }
.vis-section.wide { max-width: 980px; }
.vis-section > div[id^="vis-"] { margin: 0 auto; }
.vis-section h3 { margin-bottom: 16px; }
#vis-income, #vis-poverty, #vis-scatter, #vis-bar, #vis-small-multiples { max-width: 100%; margin: 16px auto; }
#vis-scatter, #vis-bar, #vis-small-multiples { display: flex; justify-content: center; }
#vis-scatter > div, #vis-bar > div, #vis-small-multiples > div { margin: 0 auto; }
#vis-small-multiples { flex: 0 0 auto; display: inline-block; background: #ffffffbe; padding: 24px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid rgba(0,0,0,0.05); }
label { font-size: 16px; margin-right: 10px; }
input[type="range"] { width: 80%; max-width: 400px; }
.note { max-width: 1200px; margin: 20px auto; font-size: 15px; color: #000; }
.meta { max-width: 1200px; margin: 40px auto 20px; text-align: center; font-size: 15px; color: #000; background: rgba(255,255,255,0.7); padding: 18px 24px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); border: 1px solid rgba(0,0,0,0.08); }
.meta a { color: #000; text-decoration: none; font-weight: 600; }
.meta a:hover { text-decoration: underline; }
h1 { text-align: center; font-family: 'Times New Roman', serif; letter-spacing: 0.5px; font-size: 40px; }
h2 { text-align: center; font-family: 'Times New Roman', serif; font-size: 30px; }
h3 { text-align: center; font-family: 'Times New Roman', serif; font-size: 22px; }
.full-row { max-width: 1200px; margin: 0 auto; width: 100%; display: flex; justify-content: center; }
.flex-center { display: flex; justify-content: center; width: 100%; }
.story-paragraph { max-width: 1200px; margin: 20px auto; font-size: 17px; line-height: 1.7; }
.story-paragraph p { text-align: justify; margin-bottom: 1em; }
.story-paragraph.columns { display: flex; gap: 48px; align-items: flex-start; }
.story-paragraph.columns p { flex: 1 1 0; margin: 0; }
@media (max-width: 900px) {
  .story-paragraph.columns { flex-direction: column; gap: 16px; }
}
.note, .note li { text-align: justify; }
.domain-info { max-width: 1200px; margin: 20px auto; font-size: 16px; font-weight: bold; }
.state-filter-controls { display: flex; justify-content: center; align-items: center; gap: 12px; margin: 10px auto 30px; font-weight: 600; }
.state-filter-controls button { padding: 6px 14px; border: 1px solid #888; background: white; border-radius: 4px; cursor: pointer; }
.state-filter-controls button:hover { background: #e5fbff; }
.map-controls { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 14px; margin: 10px auto 20px; }
.map-controls label { font-size: 13px; font-weight: 600; margin-right: 4px; }
.map-controls input[type="range"] { width: 160px; max-width: none; }
.map-controls select { padding: 4px 10px; border: 1px solid #888; border-radius: 4px; background: white; cursor: pointer; }
.vega-embed { margin: 0 auto; }
</style>
</head>
<body>
<h1>Economic Inequality and Living Standards Across Malaysian States (2022)</h1>
<div class="state-filter-controls">
  <span id="state-filter-status">Filter Showing: All states</span>
  <button id="state-filter-clear" type="button">Clear filter</button>
</div>
<div class="story-paragraph columns">
  <p>This dashboard examines regional inequality in income and living standards across Malaysian states in 2022. The visuals show that prosperity is concentrated in urbanised areas, while many rural and East Malaysian regions still face persistent poverty.</p>
  <p>Overall, the findings highlight that economic growth in Malaysia remains uneven, underscoring the need for more inclusive development across all regions.</p>
</div>

<div class="note">
  <strong>Indicator definitions:</strong>
  <ul>
    <li><strong>Income Mean</strong>: Average monthly household income.</li>
    <li><strong>Income Median</strong>: Middle value of household income; usually lower than the mean because of income inequality.</li>
    <li><strong>Absolute Poverty</strong>: Percentage of households earning below the Poverty Line Income (PLI).</li>
    <li><strong>Hardcore Poverty</strong>: Percentage of households earning below the Food Poverty Line Income (Food PLI).</li>
    <li><strong>Relative Poverty</strong>: Percentage of households earning below half of their state’s median income.</li>
  </ul>
</div>

<h2>Regional Income and Poverty Distribution Across Malaysian States</h2>
<div class="story-paragraph columns" style="margin-top: 8px;">
  <p>Users can adjust the zoom to examine specific areas more closely or use the focus option to highlight a particular state.</p>
  <p>The interactive sliders also allow users to filter states by income and poverty thresholds.</p>
</div>
<div class="map-controls">
  <label for="map-zoom">Zoom:</label>
  <input type="range" id="map-zoom" min="700" max="2200" step="50" value="1300">
  <label for="map-center">Focus:</label>
  <select id="map-center">
    <option value="national">Whole Malaysia</option>
    <option value="peninsular">Peninsular Malaysia</option>
    <option value="east">East Malaysia</option>
  </select>
</div>
<div class="story-paragraph columns">
  <p>These choropleth maps illustrate the geographic distribution of median household income and absolute poverty rates across Malaysian states in 2022. The map on the left shades states according to income levels, where darker blue tones represent higher median incomes, indicating greater economic prosperity.</p>
  <p>In contrast, the map on the right uses red tones to represent absolute poverty rates, where darker shades indicate higher poverty levels. This highlights the regional imbalance, with urban states showing greater prosperity while rural and East Malaysian regions remain more affected by poverty.</p>
</div>
<div class="container">
  <div class="vis-section">
    <h3>Median Household Income</h3>
    <div id="income-slider-container" style="text-align:center;margin:20px 0;">
      <label for="income-slider">Filter by Minimum Median Income (RM): </label>
      <input type="range" id="income-slider" min="0" max="12000" step="50" value="0">
      <span id="slider-value-income">0</span>
    </div>
    <div id="vis-income"></div>
  </div>

  <div class="vis-section">
    <h3>Absolute Poverty Rate</h3>
    <div id="poverty-slider-container" style="text-align:center;margin:20px 0;">
      <label for="poverty-slider">Filter by Minimum Absolute Poverty (%): </label>
      <input type="range" id="poverty-slider" min="0" max="20" step="0.1" value="0">
      <span id="slider-value-poverty">0</span>
    </div>
    <div id="vis-poverty"></div>
  </div>
</div>

<h2>The Income–Poverty Gap Across Malaysian States</h2>
<div class="story-paragraph columns">
  <p>The visualisation shows a negative relationship between median income and absolute poverty, where states with higher incomes generally have lower poverty rates. <strong>Sabah</strong> stands out as an outlier with the highest poverty rate despite having only a moderately low median income, suggesting other factors may be driving its poverty levels.</p>
  <p>In contrast, <strong>Kuala Lumpur</strong>, <strong>Selangor</strong>, and <strong>Putrajaya</strong> form a cluster of high-income, low-poverty states, reflecting stronger economies and better living conditions. In addition, the State Income Brush below lets users highlight and compare states by income, helping to visualise overall disparities across Malaysia.</p>
</div>
<div class="full-row flex-center">
  <div class="vis-section wide">
    <h3>Median Income vs Absolute Poverty</h3>
    <div id="vis-scatter"></div>
  </div>
</div>

<h2>Comparative State Performance Across Metrics</h2>
<div class="story-paragraph columns">
  <p>This heatmap compares economic well-being across Malaysian states, where deeper blues signal stronger performance. Indicators such as median household income and poverty measures provide a multidimensional view of living standards. <strong>Kuala Lumpur</strong>, <strong>Putrajaya</strong>, and <strong>Selangor</strong> shine with the boldest blues and lowest poverty levels, reflecting high prosperity and stability.</p>
  <p>In contrast, <strong>Sabah</strong> and <strong>Kelantan</strong> display paler tones alongside deeper poverty hues, highlighting ongoing disparities. Overall, the visual reveals a clear urban–rural divide, where economic opportunities and better living conditions remain concentrated in developed regions.</p>
</div>
<div class="full-row">
  <div class="vis-section wide">
    <div id="vis-bar"></div>
  </div>
</div>

<h2>State-by-State Comparison of Key Socioeconomic Indicators</h2>
<div class="story-paragraph columns" style="margin-top: 8px;">
  <p>The small multiples break down each metric by state, providing a concise grid of comparisons that highlights regional strengths and weaknesses at a glance. States that consistently appear at the top across multiple charts signal broad-based resilience, while those clustering at the bottom warrant closer attention.</p>
  <p><strong>Sabah</strong> stands out with high poverty rates across all measures, underscoring persistent hardship, whereas <strong>Putrajaya</strong> and <strong>Kuala Lumpur</strong> maintain strong income levels across both mean and median indicators. The paired views reinforce how economic resilience and vulnerability are distributed across the country.</p>
</div>
<div class="full-row">
  <div id="vis-small-multiples"></div>
</div>

<footer class="meta">
  <p><strong>Author:</strong> Rachelle Yap Zen Yi</p>
  <p><strong>Date:</strong> 19th October 2025</p>
  <p><strong>Data Sources:</strong>
    <a href="https://data.gov.my/data-catalogue/hh_income_state" target="_blank" rel="noopener noreferrer">Household Income by State</a>
    &nbsp;|&nbsp;
    <a href="https://open.dosm.gov.my/data-catalogue/hh_poverty_state" target="_blank" rel="noopener noreferrer">Poverty by State</a>
  </p>
</footer>

<script>
// --- state filter wiring shared across charts ---
const statefulViews = [];
let currentStateFilter = null;

function applyStateFilter(view, value) { view.signal('stateFilter', value).run(); }
function refreshStateFilterLabel() {
  const labelEl = document.getElementById('state-filter-status');
  if (!labelEl) return;
  labelEl.textContent = currentStateFilter ? `Showing: ${currentStateFilter}` : 'Filter Showing: All states';
}
function updateStateFilter(value) { currentStateFilter = value; statefulViews.forEach(v => applyStateFilter(v, value)); refreshStateFilterLabel(); }
function attachStateClickHandlers(view) {
  view.addEventListener('click', (_, item) => {
    const clickedState = item && item.datum && item.datum.state;
    if (!clickedState) return;
    updateStateFilter(clickedState === currentStateFilter ? null : clickedState);
  });
  view.addEventListener('dblclick', () => updateStateFilter(null));
}
function registerStatefulView(view, { enableClick = true } = {}) {
  statefulViews.push(view);
  if (currentStateFilter !== null) applyStateFilter(view, currentStateFilter);
  if (enableClick) attachStateClickHandlers(view);
}
document.getElementById('state-filter-clear').addEventListener('click', () => updateStateFilter(null));
refreshStateFilterLabel();

// --- map zoom/center controls shared by the two maps ---
const mapViews = [];
const mapCenterOptions = {
  national: { lon: 110, lat: 4.5, scale: 1300 },
  peninsular: { lon: 102.5, lat: 4.5, scale: 2000 },
  east: { lon: 113.5, lat: 3.8, scale: 1700 }
};
const mapConfig = { ...mapCenterOptions.national };
function applyMapSettingsToView(view) {
  view.signal('mapScale', mapConfig.scale).run();
  view.signal('mapCenterLon', mapConfig.lon).run();
  view.signal('mapCenterLat', mapConfig.lat).run();
}
function registerMapView(view) { mapViews.push(view); applyMapSettingsToView(view); }
function updateMapScale(scale) { mapConfig.scale = scale; mapViews.forEach(v => v.signal('mapScale', scale).run()); }
function updateMapCenter({ lon, lat }) {
  mapConfig.lon = lon; mapConfig.lat = lat;
  mapViews.forEach(v => { v.signal('mapCenterLon', lon).run(); v.signal('mapCenterLat', lat).run(); });
}
const mapZoomInput = document.getElementById('map-zoom');
mapZoomInput.value = mapConfig.scale;
mapZoomInput.addEventListener('input', e => updateMapScale(+e.target.value));
document.getElementById('map-center').addEventListener('change', e => {
  const option = mapCenterOptions[e.target.value] || mapCenterOptions.national;
  mapZoomInput.value = option.scale;
  updateMapScale(option.scale); updateMapCenter(option);
});

// --- embed all charts from external JSON specs ---
function embedSpec(target, url, onReady) {
  return vegaEmbed(target, url, { actions: false }).then(({ view }) => { if (onReady) onReady(view); return view; });
}
embedSpec("#vis-income", "js/spec-income.json", (view) => {
  const slider = document.getElementById('income-slider');
  const out = document.getElementById('slider-value-income');
  out.textContent = slider.value;
  view.signal('minIncome', +slider.value).run();
  slider.addEventListener('input', e => { const v = +e.target.value; out.textContent = v; view.signal('minIncome', v).run(); });
  registerStatefulView(view); registerMapView(view);
});
embedSpec("#vis-poverty", "js/spec-poverty.json", (view) => {
  const slider = document.getElementById('poverty-slider');
  const out = document.getElementById('slider-value-poverty');
  out.textContent = slider.value;
  view.signal('minPoverty', +slider.value).run();
  slider.addEventListener('input', e => { const v = +e.target.value; out.textContent = v; view.signal('minPoverty', v).run(); });
  registerStatefulView(view); registerMapView(view);
});
embedSpec("#vis-scatter", "js/spec-scatter.json", (view) => { registerStatefulView(view); });
embedSpec("#vis-bar", "js/spec-heatmap.json", (view) => { registerStatefulView(view); });
embedSpec("#vis-small-multiples", "js/spec-small-multiples.json", (view) => { registerStatefulView(view); });
</script>
</body>
</html>
